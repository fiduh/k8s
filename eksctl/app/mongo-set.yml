# ---
# # MongoDB ConfigMap
# apiVersion: v1
# kind: ConfigMap
# metadata:
#   name: mongodb-config
#   namespace: go-3tier-app
# data:
#   mongo.conf: |
#     storage:
#       dbPath: /data/db
#     net:
#       port: 27017
#       bindIp: 0.0.0.0

# ---
# # MongoDB Secret
# apiVersion: v1
# kind: Secret
# metadata:
#   name: mongodb-secret
#   namespace: go-3tier-app
# type: Opaque
# data:
#   mongodb-root-username: YWRtaW4=
#   mongodb-root-password: cGFzc3dvcmQxMjM=

# ---
# # Headless Service for StatefulSet
# apiVersion: v1
# kind: Service
# metadata:
#   name: mongodb-headless
#   namespace: go-3tier-app
#   labels:
#     app: mongodb
# spec:
#   ports:
#     - port: 27017
#       targetPort: 27017
#       name: mongodb
#   clusterIP: None # Headless service
#   selector:
#     app: mongodb

# ---
# # StatefulSet
# apiVersion: apps/v1
# kind: StatefulSet
# metadata:
#   name: mongodb
#   namespace: go-3tier-app
# spec:
#   serviceName: mongodb-headless
#   replicas: 1 # Increase to 3 for replica set
#   selector:
#     matchLabels:
#       app: mongodb
#   template:
#     metadata:
#       labels:
#         app: mongodb
#     spec:
#       containers:
#         - name: mongodb
#           image: mongo:7.0
#           ports:
#             - containerPort: 27017
#               name: mongodb
#           env:
#             - name: MONGO_INITDB_ROOT_USERNAME
#               valueFrom:
#                 secretKeyRef:
#                   name: mongodb-secret
#                   key: mongodb-root-username
#             - name: MONGO_INITDB_ROOT_PASSWORD
#               valueFrom:
#                 secretKeyRef:
#                   name: mongodb-secret
#                   key: mongodb-root-password
#           volumeMounts:
#             - name: mongodb-data
#               mountPath: /data/db
#             - name: mongodb-config
#               mountPath: /etc/mongo
#           resources:
#             requests:
#               memory: "512Mi"
#               cpu: "500m"
#             limits:
#               memory: "1Gi"
#               cpu: "1000m"
#           livenessProbe:
#             exec:
#               command:
#                 - mongosh
#                 - --eval
#                 - "db.adminCommand('ping')"
#             initialDelaySeconds: 30
#             periodSeconds: 10
#             timeoutSeconds: 5
#           readinessProbe:
#             exec:
#               command:
#                 - mongosh
#                 - --eval
#                 - "db.adminCommand('ping')"
#             initialDelaySeconds: 5
#             periodSeconds: 10
#             timeoutSeconds: 5
#       volumes:
#         - name: mongodb-config
#           configMap:
#             name: mongodb-config
#   # VolumeClaimTemplates automatically create PVCs for each replica
#   volumeClaimTemplates:
#     - metadata:
#         name: mongodb-data
#       spec:
#         accessModes: ["ReadWriteOnce"]
#         storageClassName: auto-ebs-sc
#         resources:
#           requests:
#             storage: 1Gi

# ---
# # Client Service for StatefulSet (for app connections)
# apiVersion: v1
# kind: Service
# metadata:
#   name: mongodb-service
#   namespace: go-3tier-app
# spec:
#   type: ClusterIP
#   ports:
#     - port: 27017
#       targetPort: 27017
#   selector:
#     app: mongodb
